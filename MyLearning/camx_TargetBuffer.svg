<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2876px" preserveAspectRatio="none" style="width:2415px;height:2876px;" version="1.1" viewBox="0 0 2415 2876" width="2415px" zoomAndPan="magnify"><defs><filter height="300%" id="fabd5eticbwvd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="1113.5" y="26.708">camx TargetBuffer</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1198" y="43.9482">Lin Jin</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="440" x="988.5" y="60.2451">Actually I want to know how Large Buffer Map or Malloc</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="507" x="957.5" y="76.542">Think this can also who fillin the RDIbuffer, and we just get that.</text><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="2383.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="633" y="434.2656"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="124.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="471.5313"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="664.4609"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="748.7266"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="847.9922"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1444.3672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="932.3906"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="185.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2420.8906"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2650.2188"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2734.4844"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1182.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1003" y="1138.4531"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1093.7734" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1008" y="1190.7188"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="954.9766" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1232" y="1294.3828"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="524.7891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1428" y="1695.4375"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="79.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1433" y="1732.7031"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="327.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1433" y="1856.1016"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="98.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2065.5" y="2050.4297"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="2171.4219" style="stroke: #000000; stroke-width: 2.0;" width="2053" x="351" y="618.3281"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1390.2344" style="stroke: #000000; stroke-width: 2.0;" width="2033" x="361" y="952.5234"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1359.1016" style="stroke: #000000; stroke-width: 2.0;" width="2013" x="371" y="976.6563"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1327.9688" style="stroke: #000000; stroke-width: 2.0;" width="1993" x="381" y="1000.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="637.5" x2="637.5" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1007.5" x2="1007.5" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1237" x2="1237" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1432.5" x2="1432.5" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1750.5" x2="1750.5" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1912.5" x2="1912.5" y1="122.1406" y2="2835.8828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2070.5" x2="2070.5" y1="122.1406" y2="2835.8828"/><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="215" x="528.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="201" x="535.5" y="106.8389">chxadvancedcamerausecase</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="215" x="528.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="201" x="535.5" y="2854.8779">chxadvancedcamerausecase</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="943.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="950.5" y="106.8389">chxusecaseutils</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="943.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="950.5" y="2854.8779">chxusecaseutils</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1200" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1207" y="106.8389">camxchi</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="1200" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1207" y="2854.8779">camxchi</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="1334.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="179" x="1341.5" y="106.8389">camximagebuffermanager</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="1334.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="179" x="1341.5" y="2854.8779">camximagebuffermanager</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1679.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1686.5" y="106.8389">camxmempoomgr</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1679.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1686.5" y="2854.8779">camxmempoomgr</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1832.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1839.5" y="106.8389">camxmempoolgroup</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1832.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1839.5" y="2854.8779">camxmempoolgroup</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2002.5" y="86.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2009.5" y="106.8389">camximagebuffer</text><rect fill="#FEFECE" filter="url(#fabd5eticbwvd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2002.5" y="2834.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2009.5" y="2854.8779">camximagebuffer</text><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="2383.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="633" y="434.2656"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="124.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="471.5313"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="664.4609"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="748.7266"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="847.9922"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1444.3672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="932.3906"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="185.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2420.8906"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2650.2188"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="40.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="638" y="2734.4844"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1182.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1003" y="1138.4531"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="1093.7734" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1008" y="1190.7188"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="954.9766" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1232" y="1294.3828"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="524.7891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1428" y="1695.4375"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="79.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1433" y="1732.7031"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="327.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1433" y="1856.1016"/><rect fill="#FFFFFF" filter="url(#fabd5eticbwvd)" height="98.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2065.5" y="2050.4297"/><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="8,137.1406,8,389.1406,629,389.1406,629,147.1406,619,137.1406,8,137.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="619" y1="137.1406" y2="147.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="629" x2="619" y1="147.1406" y2="147.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="154.2075"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="14" y="169.3403">ChiGetBufferManagerOps()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="184.4731">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="165" y="184.4731">pCreate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="280" y="184.4731">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="188" x="295" y="184.4731">ChiBufferManagerCreate;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="199.606">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="165" y="199.606">pDestroy</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="284" y="199.606">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="299" y="199.606">ChiBufferManagerDestroy;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="214.7388">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="165" y="214.7388">pGetImageBuffer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="322" y="214.7388">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="257" x="337" y="214.7388">ChiBufferManagerGetImageBuffer;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="229.8716">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="165" y="229.8716">pAddReference</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="319" y="229.8716">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="334" y="229.8716">ChiBufferManagerAddReference;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="245.0044">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="165" y="245.0044">pReleaseReference</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="327" y="245.0044">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="272" x="342" y="245.0044">ChiBufferManagerReleaseReference;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="260.1372">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="165" y="260.1372">pGetReference</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="315" y="260.1372">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="330" y="260.1372">ChiBufferManagerGetReference;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="275.27">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="165" y="275.27">pActivate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="294" y="275.27">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="199" x="309" y="275.27">ChiBufferManagerActivate;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="290.4028">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="165" y="290.4028">pDeactivate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="303" y="290.4028">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="318" y="290.4028">ChiBufferManagerDeactivate;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="305.5356">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="165" y="305.5356">pBindBuffer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="303" y="305.5356">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="318" y="305.5356">ChiBufferManagerBindBuffer;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="320.6685">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="165" y="320.6685">pGetCPUAddress</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="326" y="320.6685">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="256" x="341" y="320.6685">ChiBufferManagerGetCPUAddress;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="335.8013">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="165" y="335.8013">pGetFileDescriptor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="318" y="335.8013">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="333" y="335.8013">ChiBufferManagerGetFileDescriptor;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="350.9341">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="165" y="350.9341">pGetGrallocHandle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="323" y="350.9341">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="338" y="350.9341">ChiBufferManagerGetGrallocHandle;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="22" y="366.0669">pBufferManagerOps-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="165" y="366.0669">pCacheOps</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="308" y="366.0669">=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="213" x="323" y="366.0669">ChiBufferManagerCacheOps;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="381.1997"/><ellipse cx="10.5" cy="433.5156" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="621,430.2656,631,434.2656,621,438.2656,625,434.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="15" x2="627" y1="434.2656" y2="434.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="18" y="414.3325">CameraUsecaseBase::</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="18" y="429.4653">Initialize()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="458.6641" y2="458.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="458.6641" y2="471.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="471.6641" y2="471.6641"/><polygon fill="#A80036" points="659,467.6641,649,471.6641,659,475.6641,655,471.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="222" x="655" y="453.5981">GenerateInternalBufferIndex()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="411,489.6641,411,559.6641,860,559.6641,860,499.6641,850,489.6641,411,489.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="850" x2="850" y1="489.6641" y2="499.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="850" y1="499.6641" y2="499.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="417" y="506.731">loop sinkTarget.numTargets</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="425" y="521.8638">if StreamIsInternal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="441" y="536.9966">m_targetBuffers[targetId].pChiStream = pTarget-&gt;pChiStream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="417" y="552.1294">end loop</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="595.3281" y2="595.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="595.3281" y2="608.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="608.3281" y2="608.3281"/><polygon fill="#A80036" points="653,604.3281,643,608.3281,653,612.3281,649,608.3281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="590.2622">return</text><rect fill="none" height="2171.4219" style="stroke: #000000; stroke-width: 2.0;" width="2053" x="351" y="618.3281"/><polygon fill="#EEEEEE" points="351,618.3281,428,618.3281,428,625.3281,418,635.3281,351,635.3281,351,618.3281" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="366" y="631.395">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="443" y="630.5386">[m_pChiUsecase-&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="562" y="630.5386">numPipelines</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="648" y="630.5386">]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="651.5938" y2="651.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="651.5938" y2="664.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="664.5938" y2="664.5938"/><polygon fill="#A80036" points="659,660.5938,649,664.5938,659,668.5938,655,664.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="655" y="646.5278">CreatePipeline()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="703.7266" y2="703.7266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="703.7266" y2="716.7266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="716.7266" y2="716.7266"/><polygon fill="#A80036" points="653,712.7266,643,716.7266,653,720.7266,649,716.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="698.6606">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="735.8594" y2="735.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="735.8594" y2="748.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="748.8594" y2="748.8594"/><polygon fill="#A80036" points="659,744.8594,649,748.8594,659,752.8594,655,748.8594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="214" x="655" y="730.7935">PipelineHasHalInputStream()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="787.9922" y2="787.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="787.9922" y2="800.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="800.9922" y2="800.9922"/><polygon fill="#A80036" points="653,796.9922,643,800.9922,653,804.9922,649,800.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="782.9263">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="835.2578" y2="835.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="835.2578" y2="848.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="848.2578" y2="848.2578"/><polygon fill="#A80036" points="659,844.2578,649,848.2578,659,852.2578,655,848.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="655" y="815.0591">PipelineCreated</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="655" y="830.1919">(sessionId, pipelineId)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="887.3906" y2="887.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="887.3906" y2="900.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="900.3906" y2="900.3906"/><polygon fill="#A80036" points="653,896.3906,643,900.3906,653,904.3906,649,900.3906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="882.3247">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="919.5234" y2="919.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="919.5234" y2="932.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="932.5234" y2="932.5234"/><polygon fill="#A80036" points="659,928.5234,649,932.5234,659,936.5234,655,932.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="655" y="914.4575">CreateInternalBufferManager()</text><rect fill="none" height="1390.2344" style="stroke: #000000; stroke-width: 2.0;" width="2033" x="361" y="952.5234"/><polygon fill="#EEEEEE" points="361,952.5234,438,952.5234,438,959.5234,428,969.5234,361,969.5234,361,952.5234" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="376" y="965.5903">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="453" y="964.7339">[m_pChiUsecase-&gt;numPipelines]</text><rect fill="none" height="1359.1016" style="stroke: #000000; stroke-width: 2.0;" width="2013" x="371" y="976.6563"/><polygon fill="#EEEEEE" points="371,976.6563,448,976.6563,448,983.6563,438,993.6563,371,993.6563,371,976.6563" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="386" y="989.7231">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="463" y="988.8667">[sinkTarget.numTargets]</text><rect fill="none" height="1327.9688" style="stroke: #000000; stroke-width: 2.0;" width="1993" x="381" y="1000.7891"/><polygon fill="#EEEEEE" points="381,1000.7891,445,1000.7891,445,1007.7891,435,1017.7891,381,1017.7891,381,1000.7891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="396" y="1013.856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="460" y="1012.9995">[TRUE==</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="516" y="1012.9995">StreamIsInternal()</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="632" y="1012.9995">]</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="391,1022.9219,391,1092.9219,881,1092.9219,881,1032.9219,871,1022.9219,391,1022.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="871" x2="871" y1="1022.9219" y2="1032.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="871" y1="1032.9219" y2="1032.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="397" y="1039.9888">1. create</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="458" y="1039.9888">CHIBufferManagerCreateData</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="397" y="1055.1216">2. createData.maxBufferCount =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="612" y="1055.1216">BufferQueueDepth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="750" y="1055.1216">, this is configured</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="397" y="1070.2544">3. createData.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="489" y="1070.2544">bEnableLataBinding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="397" y="1085.3872">4. set consumerFlags, if CPU can read</text><polygon fill="#A80036" points="991,1134.4531,1001,1138.4531,991,1142.4531,995,1138.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="997" y1="1138.4531" y2="1138.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="655" y="1118.52">CHIBufferManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="795" y="1118.52"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="659" y="1133.6528"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61" x="659" y="1133.6528">Create()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1013" x2="1060" y1="1177.9844" y2="1177.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1060" x2="1060" y1="1177.9844" y2="1190.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019" x2="1060" y1="1190.9844" y2="1190.9844"/><polygon fill="#A80036" points="1029,1186.9844,1019,1190.9844,1029,1194.9844,1025,1190.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="1025" y="1157.7856">CHIBufferManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1165" y="1157.7856"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1029" y="1172.9185"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1029" y="1172.9185">Initialize()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="825,1208.9844,825,1263.9844,1186,1263.9844,1186,1218.9844,1176,1208.9844,825,1208.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1176" x2="1176" y1="1208.9844" y2="1218.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1186" x2="1176" y1="1218.9844" y2="1218.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="831" y="1226.0513">There is a Config</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="941" y="1226.0513">EnableUnifiedBufferManager()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="831" y="1241.1841">if that is True:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="847" y="1256.3169"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="324" x="847" y="1256.3169">m_bIsUnifiedBufferManagerEnabled = TRUE</text><polygon fill="#A80036" points="1220,1290.3828,1230,1294.3828,1220,1298.3828,1224,1294.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1018" x2="1226" y1="1294.3828" y2="1294.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="1025" y="1289.4497">ChiBufferManagerCreate()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="1044,1307.5156,1044,1649.5156,1426,1649.5156,1426,1317.5156,1416,1307.5156,1044,1307.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1416" x2="1416" y1="1307.5156" y2="1317.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1426" x2="1416" y1="1317.5156" y2="1317.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="361" x="1050" y="1324.5825">转换ChiStream里面的color space 和rotation为统一的ImageFormat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="1050" y="1339.7153">调用</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="1066" y="1339.7153">InitializeFormatParams</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1236" y="1339.7153">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="1066" y="1354.8481">Y8:          bitsPerPixel=8;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1066" y="1369.981">RawPlain16:  bitPerpixel=10;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1066" y="1385.1138">RawPlain64:  bitPerpixel=8;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1066" y="1400.2466">RawMIPI8:    bitPerpixel=8;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="1066" y="1415.3794">RawMIPI:   bitWidth:8 -&gt;  bitPerpixel=8;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1066" y="1430.5122">RawMIPI:   bitWidth:10-&gt;  bitPerpixel=10;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1066" y="1445.645">RawMIPI:   bitWidth:12-&gt;  bitPerpixel=12;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1066" y="1460.7778">RawMIPI:   bitWidth:14-&gt;  bitPerpixel=14;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1066" y="1475.9106">P010:      Align and w/h etc.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1066" y="1491.0435">YUV420NV12/YUV420NV21: Align and w/h etc.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1066" y="1506.1763">PD10:      wight/height/stride</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="1066" y="1521.3091">YUV422NV16:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1054" y="1536.4419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1050" y="1551.5747">BufferHeap:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="1066" y="1566.7075">System --&gt;  CSLBufferHeapSystem</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1066" y="1581.8403">Ion    --&gt;  CSLBufferHeapIon</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="1066" y="1596.9731">DSP    --&gt;  CSLBufferHeapDSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="1066" y="1612.106">EGL    --&gt;  CSLBufferHeapEGL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1054" y="1627.2388"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="1050" y="1642.3716">处理好之后，才能调用ImageBuffer去create</text><polygon fill="#A80036" points="1416,1691.4375,1426,1695.4375,1416,1699.4375,1420,1695.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1242" x2="1422" y1="1695.4375" y2="1695.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="167" x="1249" y="1675.5044">ImageBufferManager::</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1253" y="1690.6372"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="1253" y="1690.6372">Create</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1438" x2="1485" y1="1719.8359" y2="1719.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1485" x2="1485" y1="1719.8359" y2="1732.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1444" x2="1485" y1="1732.8359" y2="1732.8359"/><polygon fill="#A80036" points="1454,1728.8359,1444,1732.8359,1454,1736.8359,1450,1732.8359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="1450" y="1714.77">ImageBufferManager::Initialize()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="1201,1750.8359,1201,1775.8359,1660,1775.8359,1660,1760.8359,1650,1750.8359,1201,1750.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1650" x2="1650" y1="1750.8359" y2="1760.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1660" x2="1650" y1="1760.8359" y2="1760.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="1207" y="1767.9028">will run</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="391" x="1254" y="1767.9028">MemPoolMgr::RegisterBufferManager( pCreateData)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="1485" y1="1811.1016" y2="1811.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1485" x2="1485" y1="1811.1016" y2="1824.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1438" x2="1485" y1="1824.1016" y2="1824.1016"/><polygon fill="#A80036" points="1448,1820.1016,1438,1824.1016,1448,1828.1016,1444,1824.1016" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1450" y="1806.0356">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1438" x2="1485" y1="1843.2344" y2="1843.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1485" x2="1485" y1="1843.2344" y2="1856.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1444" x2="1485" y1="1856.2344" y2="1856.2344"/><polygon fill="#A80036" points="1454,1852.2344,1444,1856.2344,1454,1860.2344,1450,1856.2344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="294" x="1450" y="1838.1685">ImageBufferManager::InitializeBuffers()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="1117,1874.2344,1117,2020.2344,1744,2020.2344,1744,1884.2344,1734,1874.2344,1117,1874.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1734" x2="1734" y1="1874.2344" y2="1884.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1744" x2="1734" y1="1884.2344" y2="1884.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="1123" y="1891.3013">1. if</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="1150" y="1891.3013">m_immediateAllocBufferCount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="1378" y="1891.3013">&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="1393" y="1891.3013">m_maxBufferCount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1534" y="1891.3013">, only alloc m_maxBufferCount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="1135" y="1906.4341">m_maxBufferCount will config in Feature like in Chxfeaturehdr</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1155" y="1921.5669">maxBufferCount = MinOutputBuffers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1135" y="1936.6997">in Advancedcamerausecase</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="1155" y="1951.8325">maxBufferCount = BuferQueueDepth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1123" y="1966.9653">2. then call</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="1135" y="1982.0981">-  pBuffer =</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="193" x="1213" y="1982.0981">CAMX_NEW ImageBuffer()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1135" y="1997.231">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="1148" y="1997.231">pBuffer-&gt;Initialize()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1135" y="2012.3638">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="1148" y="2012.3638">pBuffer-&gt;Allocate()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1295" y="2012.3638">will paint this flow</text><polygon fill="#A80036" points="2053.5,2046.4297,2063.5,2050.4297,2053.5,2054.4297,2057.5,2050.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="2059.5" y1="2050.4297" y2="2050.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="1450" y="2045.4966">ImageBuffer::Allocate()</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="1777,2063.5625,1777,2118.5625,2360,2118.5625,2360,2073.5625,2350,2063.5625,1777,2063.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2350" x2="2350" y1="2063.5625" y2="2073.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2360" x2="2350" y1="2073.5625" y2="2073.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="1783" y="2080.6294">1. 区分是在mempoolBufMgr里分配还是Gralloc分配（可以调用Gralloc接口）</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="1783" y="2095.7622">2. MemPoolMgr::</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="1890" y="2095.7622">GetBufferFromPool</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="2036" y="2095.7622">将会map buffer 到device。  然后</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="2211" y="2095.7622">ImportCSLBuffer()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="1783" y="2110.895">3. Gralloc, 分配buf后，调用CSLMapNativeBuffer 来map，然后</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="2119" y="2110.895">ImportCSLBuffer()</text><polygon fill="#A80036" points="1454,2144.9609,1444,2148.9609,1454,2152.9609,1450,2148.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1448" x2="2069.5" y1="2148.9609" y2="2148.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1460" y="2144.0278">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="1485" y1="2183.2266" y2="2183.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1485" x2="1485" y1="2183.2266" y2="2196.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1438" x2="1485" y1="2196.2266" y2="2196.2266"/><polygon fill="#A80036" points="1448,2192.2266,1438,2196.2266,1448,2200.2266,1444,2196.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1450" y="2178.1606">return</text><polygon fill="#A80036" points="1253,2216.2266,1243,2220.2266,1253,2224.2266,1249,2220.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1432" y1="2220.2266" y2="2220.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1259" y="2215.2935">return</text><polygon fill="#A80036" points="1029,2245.3594,1019,2249.3594,1029,2253.3594,1025,2249.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1023" x2="1236" y1="2249.3594" y2="2249.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1035" y="2244.4263">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1018" x2="1060" y1="2283.625" y2="2283.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1060" x2="1060" y1="2283.625" y2="2296.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1013" x2="1060" y1="2296.625" y2="2296.625"/><polygon fill="#A80036" points="1023,2292.625,1013,2296.625,1023,2300.625,1019,2296.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1025" y="2278.5591">return</text><polygon fill="#A80036" points="659,2316.625,649,2320.625,659,2324.625,655,2320.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="653" x2="1007" y1="2320.625" y2="2320.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="665" y="2315.6919">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="2375.8906" y2="2375.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2375.8906" y2="2388.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2388.8906" y2="2388.8906"/><polygon fill="#A80036" points="653,2384.8906,643,2388.8906,653,2392.8906,649,2388.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="2370.8247">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2408.0234" y2="2408.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2408.0234" y2="2421.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="2421.0234" y2="2421.0234"/><polygon fill="#A80036" points="659,2417.0234,649,2421.0234,659,2425.0234,655,2421.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="346" x="655" y="2402.9575">CreateSessionWithInputHalStream(pCallbacks)</text><polygon fill="#FBFB77" filter="url(#fabd5eticbwvd)" points="384,2439.0234,384,2570.0234,888,2570.0234,888,2449.0234,878,2439.0234,384,2439.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="878" x2="878" y1="2439.0234" y2="2449.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="888" x2="878" y1="2449.0234" y2="2449.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="390" y="2456.0903">the callbacks:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="398" y="2471.2231">typedef struct ChiCallBacks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="398" y="2486.356">/// @brief CHI app callback method to send back the capture results</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="398" y="2501.4888"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="398" y="2501.4888">void (*ChiProcessCaptureResult)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="398" y="2516.6216">/// @brief Asynchronous notification callback method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="398" y="2531.7544"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="398" y="2531.7544">void (*ChiNotify)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="398" y="2546.8872">/// @brief CHI app callback method to send back the partial capture results</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="398" y="2562.02"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="289" x="398" y="2562.02">void (*ChiProcessPartialCaptureResult)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="2605.2188" y2="2605.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2605.2188" y2="2618.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2618.2188" y2="2618.2188"/><polygon fill="#A80036" points="653,2614.2188,643,2618.2188,653,2622.2188,649,2618.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="2600.1528">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2637.3516" y2="2637.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2637.3516" y2="2650.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="2650.3516" y2="2650.3516"/><polygon fill="#A80036" points="659,2646.3516,649,2650.3516,659,2654.3516,655,2650.3516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="12" x="655" y="2632.2856">()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="2689.4844" y2="2689.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2689.4844" y2="2702.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2702.4844" y2="2702.4844"/><polygon fill="#A80036" points="653,2698.4844,643,2702.4844,653,2706.4844,649,2702.4844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="2684.4185">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2721.6172" y2="2721.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2721.6172" y2="2734.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="649" x2="690" y1="2734.6172" y2="2734.6172"/><polygon fill="#A80036" points="659,2730.6172,649,2734.6172,659,2738.6172,655,2734.6172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="12" x="655" y="2716.5513">()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="648" x2="690" y1="2773.75" y2="2773.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="690" x2="690" y1="2773.75" y2="2786.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="643" x2="690" y1="2786.75" y2="2786.75"/><polygon fill="#A80036" points="653,2782.75,643,2786.75,653,2790.75,649,2786.75" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="655" y="2768.6841">return</text><polygon fill="#A80036" points="22,2813.75,12,2817.75,22,2821.75,18,2817.75" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="637.5" cy="2817" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="16" x2="633" y1="2817.75" y2="2817.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="28" y="2812.8169">return</text><!--
@startuml
title <size:18>camx TargetBuffer</size>\n     Lin Jin\n Actually I want to know how Large Buffer Map or Malloc \n Think this can also who fillin the RDIbuffer, and we just get that.
participant chxadvancedcamerausecase
participant chxusecaseutils
participant camxchi
participant camximagebuffermanager
participant camxmempoomgr
participant camxmempoolgroup

note left chxadvancedcamerausecase

  **ChiGetBufferManagerOps()**
    pBufferManagerOps->**pCreate**              = **ChiBufferManagerCreate;**
    pBufferManagerOps->**pDestroy**             = **ChiBufferManagerDestroy;**
    pBufferManagerOps->**pGetImageBuffer     ** = **ChiBufferManagerGetImageBuffer;**
    pBufferManagerOps->**pAddReference       ** = **ChiBufferManagerAddReference;**
    pBufferManagerOps->**pReleaseReference   ** = **ChiBufferManagerReleaseReference;**
    pBufferManagerOps->**pGetReference       ** = **ChiBufferManagerGetReference;**
    pBufferManagerOps->**pActivate           ** = **ChiBufferManagerActivate;**
    pBufferManagerOps->**pDeactivate         ** = **ChiBufferManagerDeactivate;**
    pBufferManagerOps->**pBindBuffer         ** = **ChiBufferManagerBindBuffer;**
    pBufferManagerOps->**pGetCPUAddress      ** = **ChiBufferManagerGetCPUAddress;**
    pBufferManagerOps->**pGetFileDescriptor  ** = **ChiBufferManagerGetFileDescriptor;**
    pBufferManagerOps->**pGetGrallocHandle   ** = **ChiBufferManagerGetGrallocHandle;**
    pBufferManagerOps->**pCacheOps           ** = **ChiBufferManagerCacheOps;**

end note

[o->chxadvancedcamerausecase: **CameraUsecaseBase::**\n**Initialize()**
activate chxadvancedcamerausecase
  chxadvancedcamerausecase->chxadvancedcamerausecase: **GenerateInternalBufferIndex()**
  activate chxadvancedcamerausecase
    note over chxadvancedcamerausecase
      loop sinkTarget.numTargets
        if StreamIsInternal
            m_targetBuffers[targetId].pChiStream = pTarget->pChiStream
      end loop
    end note
  chxadvancedcamerausecase->chxadvancedcamerausecase: return
  deactivate chxadvancedcamerausecase

  loop m_pChiUsecase->**numPipelines**
    chxadvancedcamerausecase->chxadvancedcamerausecase: **CreatePipeline()**
    activate chxadvancedcamerausecase
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase


    chxadvancedcamerausecase->chxadvancedcamerausecase: **PipelineHasHalInputStream()**
    activate chxadvancedcamerausecase
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase


    chxadvancedcamerausecase->chxadvancedcamerausecase: **PipelineCreated**\n**(sessionId, pipelineId)**
    activate chxadvancedcamerausecase
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase


    chxadvancedcamerausecase->chxadvancedcamerausecase: **CreateInternalBufferManager()**
    activate chxadvancedcamerausecase
      loop m_pChiUsecase->numPipelines
          loop sinkTarget.numTargets
              alt TRUE==**StreamIsInternal()**
                note over chxadvancedcamerausecase
                    1. create **CHIBufferManagerCreateData**
                    2. createData.maxBufferCount = **BufferQueueDepth**, this is configured
                    3. createData.**bEnableLataBinding**
                    4. set consumerFlags, if CPU can read
                end note

                chxadvancedcamerausecase->chxusecaseutils: **CHIBufferManager** \n **Create()**
                activate chxusecaseutils
                    chxusecaseutils->chxusecaseutils: **CHIBufferManager** \n **Initialize()**
                    activate chxusecaseutils
                        note over chxusecaseutils
                           There is a Config **EnableUnifiedBufferManager()**
                           if that is True:
                               **m_bIsUnifiedBufferManagerEnabled = TRUE**
                        end note

                        chxusecaseutils->camxchi: **ChiBufferManagerCreate()**
                        activate camxchi
                            note over camxchi
                                转换ChiStream里面的color space 和rotation为统一的ImageFormat
                                调用**InitializeFormatParams**:
                                    Y8:          bitsPerPixel=8;
                                    RawPlain16:  bitPerpixel=10;
                                    RawPlain64:  bitPerpixel=8;
                                    RawMIPI8:    bitPerpixel=8;
                                    RawMIPI:   bitWidth:8 ->  bitPerpixel=8;
                                    RawMIPI:   bitWidth:10->  bitPerpixel=10;
                                    RawMIPI:   bitWidth:12->  bitPerpixel=12;
                                    RawMIPI:   bitWidth:14->  bitPerpixel=14;
                                    P010:      Align and w/h etc.
                                    YUV420NV12/YUV420NV21: Align and w/h etc.
                                    PD10:      wight/height/stride
                                    YUV422NV16:   

                                BufferHeap: 
                                    System - ->  CSLBufferHeapSystem
                                    Ion    - ->  CSLBufferHeapIon
                                    DSP    - ->  CSLBufferHeapDSP
                                    EGL    - ->  CSLBufferHeapEGL

                                处理好之后，才能调用ImageBuffer去create
                            end note

                            camxchi->camximagebuffermanager: **ImageBufferManager::**\n **Create**
                            activate camximagebuffermanager

                                camximagebuffermanager->camximagebuffermanager: **ImageBufferManager::Initialize()**
                                activate camximagebuffermanager
                                    note over camximagebuffermanager
                                        will run **MemPoolMgr::RegisterBufferManager( pCreateData)**
                                    end note
                                camximagebuffermanager->camximagebuffermanager: return
                                deactivate camximagebuffermanager

                                camximagebuffermanager->camximagebuffermanager: **ImageBufferManager::InitializeBuffers()**
                                activate camximagebuffermanager
                                    note over camximagebuffermanager
                                        1. if **m_immediateAllocBufferCount** > **m_maxBufferCount**, only alloc m_maxBufferCount
                                           m_maxBufferCount will config in Feature like in Chxfeaturehdr
                                                maxBufferCount = MinOutputBuffers
                                           in Advancedcamerausecase
                                                maxBufferCount = BuferQueueDepth
                                        2. then call
                                           -  pBuffer = **CAMX_NEW ImageBuffer()**
                                           -  **pBuffer->Initialize()**
                                           -  **pBuffer->Allocate()** will paint this flow
                                    end note

                                    camximagebuffermanager->camximagebuffer: **ImageBuffer::Allocate()**
                                    activate camximagebuffer
                                        note over camximagebuffer
                                            1. 区分是在mempoolBufMgr里分配还是Gralloc分配（可以调用Gralloc接口）
                                            2. MemPoolMgr::**GetBufferFromPool** 将会map buffer 到device。  然后 **ImportCSLBuffer()**
                                            3. Gralloc, 分配buf后，调用CSLMapNativeBuffer 来map，然后 **ImportCSLBuffer()**
                                        end note
                                    camximagebuffer->camximagebuffermanager: return
                                    deactivate camximagebuffer

                                camximagebuffermanager->camximagebuffermanager: return
                                deactivate camximagebuffermanager

                            camximagebuffermanager->camxchi: return
                            deactivate camximagebuffermanager

                        camxchi->chxusecaseutils: return
                        deactivate camxchi

                    chxusecaseutils->chxusecaseutils: return
                    deactivate chxusecaseutils
                chxusecaseutils->chxadvancedcamerausecase: return
                deactivate chxusecaseutils
              end
          end loop
      end loop
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase

    chxadvancedcamerausecase->chxadvancedcamerausecase: **CreateSessionWithInputHalStream(pCallbacks)**
    activate chxadvancedcamerausecase
      note over chxadvancedcamerausecase
        the callbacks:
          typedef struct ChiCallBacks
          /// @brief CHI app callback method to send back the capture results
          **void (*ChiProcessCaptureResult)**
          /// @brief Asynchronous notification callback method
          **void (*ChiNotify)**
          /// @brief CHI app callback method to send back the partial capture results
          **void (*ChiProcessPartialCaptureResult)**
      end note
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase

    chxadvancedcamerausecase->chxadvancedcamerausecase: **()**
    activate chxadvancedcamerausecase
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase

    chxadvancedcamerausecase->chxadvancedcamerausecase: **()**
    activate chxadvancedcamerausecase
    chxadvancedcamerausecase->chxadvancedcamerausecase: return
    deactivate chxadvancedcamerausecase
  end loop
[o<-chxadvancedcamerausecase: return
deactivate chxadvancedcamerausecase

@enduml

PlantUML version 1.2017.20(Mon Dec 11 16:57:05 GMT 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.16.04.1-b11
Operating System: Linux
OS Version: 4.4.0-43-Microsoft
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>