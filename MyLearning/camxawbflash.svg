<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="651px" preserveAspectRatio="none" style="width:677px;height:651px;" version="1.1" viewBox="0 0 677 651" width="677px" zoomAndPan="magnify"><defs><filter height="300%" id="fggl5dxenwzq2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="256" y="26.708">camx awb flash</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="323.5" y="43.9482">Lin Jin</text><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="428.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="329" y="163.8125"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="324.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="334" y="225.0781"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="124.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="339" y="375.875"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="385.8594" style="stroke: #000000; stroke-width: 2.0;" width="642" x="13" y="178.8125"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="185.9297" style="stroke: #000000; stroke-width: 2.0;" width="622" x="23" y="329.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="333.5" x2="333.5" y1="89.5469" y2="610.8047"/><rect fill="#FEFECE" filter="url(#fggl5dxenwzq2)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="272.5" y="54.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="279.5" y="74.2451">camxcawbmain</text><rect fill="#FEFECE" filter="url(#fggl5dxenwzq2)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="272.5" y="609.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="279.5" y="629.7998">camxcawbmain</text><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="428.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="329" y="163.8125"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="324.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="334" y="225.0781"/><rect fill="#FFFFFF" filter="url(#fggl5dxenwzq2)" height="124.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="339" y="375.875"/><rect fill="#EEEEEE" filter="url(#fggl5dxenwzq2)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="662" x="3" y="120.1133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="665" y1="120.1133" y2="120.1133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="665" y1="123.1133" y2="123.1133"/><rect fill="#EEEEEE" filter="url(#fggl5dxenwzq2)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="161" x="253.5" y="109.5469"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="259.5" y="125.6138">AWBAlgoModeAuto</text><ellipse cx="10.5" cy="163.0625" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="317,159.8125,327,163.8125,317,167.8125,321,163.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="15" x2="323" y1="163.8125" y2="163.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="18" y="158.7466">*AWBProcess()*</text><path d="M13,178.8125 L77,178.8125 L77,185.8125 L67,195.8125 L13,195.8125 L13,178.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="385.8594" style="stroke: #000000; stroke-width: 2.0;" width="642" x="13" y="178.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="191.8794">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="92" y="191.0229">[whiteBalanceMode==AWBAlgoModeAuto]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="386" y1="212.0781" y2="212.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="386" x2="386" y1="212.0781" y2="225.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="345" x2="386" y1="225.0781" y2="225.0781"/><polygon fill="#A80036" points="355,221.0781,345,225.0781,355,229.0781,351,225.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="351" y="207.0122">*FlashProcess()*</text><path d="M115,243.0781 L115,313.0781 L548,313.0781 L548,253.0781 L538,243.0781 L115,243.0781 " fill="#FBFB77" filter="url(#fggl5dxenwzq2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M538,243.0781 L538,253.0781 L548,253.0781 L538,243.0781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="121" y="260.145">if curFlashState == AWBAlgoPreFlashStart &amp;&amp; flashOn==FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="137" y="275.2778">1. save curFrameDecision</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="137" y="290.4106">2. if we have AWB_Decision_AfterDA, will use this one</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="125" y="305.5435"/><path d="M23,329.6094 L87,329.6094 L87,336.6094 L77,346.6094 L23,346.6094 L23,329.6094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="185.9297" style="stroke: #000000; stroke-width: 2.0;" width="622" x="23" y="329.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="38" y="342.6763">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="102" y="341.8198">[flashType==AWBAlgoFlashTypeLED:]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="344" x2="391" y1="362.875" y2="362.875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="391" x2="391" y1="362.875" y2="375.875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350" x2="391" y1="375.875" y2="375.875"/><polygon fill="#A80036" points="360,371.875,350,375.875,360,379.875,356,375.875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="356" y="357.8091">*TransitAWBPipeline(FLASH_OFF_TO_ON)*</text><path d="M33,393.875 L33,463.875 L631,463.875 L631,403.875 L621,393.875 L33,393.875 " fill="#FBFB77" filter="url(#fggl5dxenwzq2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M621,393.875 L621,403.875 L631,403.875 L621,393.875 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="577" x="39" y="410.9419">1. use PreflashStatFilters replace curstatFilters   m_PreflashStatFilters[SFStatDistPreFlash]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="39" y="426.0747">2. if transit == FLASH_ON_TO_OFF:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="55" y="441.2075">use m_StatFilters[SFStatDist] replace</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="547" x="39" y="456.3403">从这大概理解了，在camxcawbfactory.cpp里面为什么需要那么多的StatsFilter。在不同场景会综合使用, 但是在最初就处理好了。</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="349" x2="391" y1="499.5391" y2="499.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="391" x2="391" y1="499.5391" y2="512.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="344" x2="391" y1="512.5391" y2="512.5391"/><polygon fill="#A80036" points="354,508.5391,344,512.5391,354,516.5391,350,512.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="356" y="494.4731">return</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="344" x2="386" y1="548.6719" y2="548.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="386" x2="386" y1="548.6719" y2="561.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="386" y1="561.6719" y2="561.6719"/><polygon fill="#A80036" points="349,557.6719,339,561.6719,349,565.6719,345,561.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="351" y="543.606">return</text><polygon fill="#A80036" points="22,588.8047,12,592.8047,22,596.8047,18,592.8047" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="333.5" cy="592.0547" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="16" x2="329" y1="592.8047" y2="592.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="28" y="587.7388">return</text><!--
@startuml
title <size:18>camx awb flash</size>\n     Lin Jin

participant camxcawbmain

== <color:blue>AWBAlgoModeAuto </color>==
[o->camxcawbmain: *AWBProcess()*
activate camxcawbmain
    alt whiteBalanceMode==AWBAlgoModeAuto
        camxcawbmain->camxcawbmain: *FlashProcess()*
        activate camxcawbmain
            note over camxcawbmain
                if curFlashState == AWBAlgoPreFlashStart && flashOn==FALSE
                    1. save curFrameDecision
                    2. if we have AWB_Decision_AfterDA, will use this one

            end note
            alt flashType==AWBAlgoFlashTypeLED:
                camxcawbmain->camxcawbmain: *TransitAWBPipeline(FLASH_OFF_TO_ON)*
                activate camxcawbmain
                    note over camxcawbmain
                        1. use PreflashStatFilters replace curstatFilters   m_PreflashStatFilters[SFStatDistPreFlash]
                        2. if transit == FLASH_ON_TO_OFF:
                            use m_StatFilters[SFStatDist] replace 
                        从这大概理解了，在camxcawbfactory.cpp里面为什么需要那么多的StatsFilter。在不同场景会综合使用, 但是在最初就处理好了。
                    end note
                camxcawbmain->camxcawbmain: return
                deactivate camxcawbmain
            end
        camxcawbmain->camxcawbmain: return
        deactivate camxcawbmain
    end
[o<-camxcawbmain: return
deactivate camxcawbmain
@enduml

PlantUML version 1.2019.04(Fri Mar 29 15:44:36 GMT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.16.04.1-b11
Operating System: Linux
OS Version: 4.4.0-43-Microsoft
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>